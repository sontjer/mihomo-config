
#!name = mihomo TUN é…ç½®æ–‡ä»¶
#!desc = è¯´æ˜ï¼šç†è®ºä¸Šé€‚ç”¨äºæ‰€æœ‰çš„ Meta å†…æ ¸ï¼Œä½¿ç”¨æœ€æ–°çš„ mrs è§„åˆ™
#!date = 2024-10-18 19:50
#!source = https://wiki.metacubex.one/example/conf/#__tabbed_1_2
#!author = Abcd789JK

# è¿™é‡Œæ˜¯æœºåœºè®¢é˜…æ›´æ–°å’Œå»¶è¿Ÿæµ‹è¯•ç›¸å…³é”šç‚¹
pr: &pr {type: http, interval: 3600, health-check: {enable: true, url: "https://www.gstatic.com/generate_204", interval: 300}}

# æœºåœºé…ç½®

# å…¨å±€é…ç½®
ipv6: true
allow-lan: true
mixed-port: 7890
unified-delay: true
tcp-concurrent: true

# é…ç½® WEB UI
external-ui: ui
external-controller: 0.0.0.0:9090
external-ui-url: "https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip"

find-process-mode: strict
global-client-fingerprint: chrome

# profile åº”ä¸ºæ‰©å±•é…ç½®ï¼Œä½†åœ¨ mihomo, ä»…ä½œä¸ºç¼“å­˜é¡¹ä½¿ç”¨
profile:
  store-selected: true
  store-fake-ip: true

# å—…æ¢åŸŸå å¯é€‰é…ç½®
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"
    - "+.push.apple.com"

# TUN é…ç½®
tun:
  enable: true
  stack: mixed
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true

# DNS é…ç½®
dns:
  enable: true
  ipv6: true
  respect-rules: true
  enhanced-mode: fake-ip
  fake-ip-filter:
    - "*"
    - "+.lan"
    - "+.local"
    - "+.market.xiaomi.com"
  nameserver:
    - https://120.53.53.53/dns-query
    - https://223.5.5.5/dns-query
  proxy-server-nameserver:
    - https://120.53.53.53/dns-query
    - https://223.5.5.5/dns-query
  nameserver-policy:
    "rule-set:China":
      - https://120.53.53.53/dns-query
      - https://223.5.5.5/dns-query
    "rule-set:GlobalGFW":
      - "https://dns.cloudflare.com/dns-query"
      - "https://dns.google/dns-query"

# å•ä¸ªå‡ºç«™ä»£ç†èŠ‚ç‚¹
proxies: 
  - name: "å›½å†…ç›´è¿"
    type: direct
    udp: true
    
# ç­–ç•¥ç»„ç›¸å…³
pg: &pg {type: select, proxies: [é»˜è®¤é€‰æ‹©,è‡ªåŠ¨é€‰æ‹©,å›½å†…ç›´è¿,é¦™æ¸¯,å°æ¹¾,æ—¥æœ¬,ç‹®åŸ,ç¾å›½,å…¶å®ƒåœ°åŒº,å…¨éƒ¨èŠ‚ç‚¹]}
# æ‰‹åŠ¨é€‰æ‹©ç­–ç•¥
mt: &mt {type: select, include-all: true}
# è‡ªåŠ¨ä¼˜é€‰ç­–ç•¥
at: &at {type: url-test, include-all: true, interval: 6, tolerance: 20, lazy: true, url: "https://www.gstatic.com/generate_204"}

# ç­–ç•¥ç»„
proxy-groups:
  # ç­–ç•¥åˆ†ç»„
  - name: é»˜è®¤é€‰æ‹©
    type: select
    proxies: [è‡ªåŠ¨é€‰æ‹©,å›½å†…ç›´è¿,é¦™æ¸¯,å°æ¹¾,æ—¥æœ¬,ç‹®åŸ,ç¾å›½,å…¶å®ƒåœ°åŒº,å…¨éƒ¨èŠ‚ç‚¹]
  - name: æµ·å¤–åŠ é€Ÿ
    <<: *pg
  - name: æµ·å¤–åª’ä½“
    <<: *pg
  - name: è°·æ­ŒæœåŠ¡
    <<: *pg
  - name: å¾®è½¯æœåŠ¡
    <<: *pg
  - name: ç”µæŠ¥ä¿¡æ¯
    <<: *pg
  - name: ç¤¾äº¤å¹³å°
    <<: *pg
  - name: OpenAI
    <<: *pg
  - name: æ¸¸æˆå¹³å°
    type: select
    proxies: [å›½å†…ç›´è¿,é¦™æ¸¯,å°æ¹¾,æ—¥æœ¬,ç‹®åŸ,ç¾å›½,å…¶å®ƒåœ°åŒº,å…¨éƒ¨èŠ‚ç‚¹]
  - name: è‹¹æœæœåŠ¡
    type: select
    proxies: [å›½å†…ç›´è¿,é¦™æ¸¯,å°æ¹¾,æ—¥æœ¬,ç‹®åŸ,ç¾å›½,å…¶å®ƒåœ°åŒº,å…¨éƒ¨èŠ‚ç‚¹]
  - name: å…œåº•è§„åˆ™
    type: select
    proxies: [è‡ªåŠ¨é€‰æ‹©,å›½å†…ç›´è¿,é¦™æ¸¯,å°æ¹¾,æ—¥æœ¬,ç‹®åŸ,ç¾å›½,å…¶å®ƒåœ°åŒº,å…¨éƒ¨èŠ‚ç‚¹]
  # åœ°åŒºåˆ†ç»„
  - name: é¦™æ¸¯
    type: select
    include-all: true
    filter: "(?i)æ¸¯|hk|hongkong|hong kong"
  - name: å°æ¹¾
    type: select
    include-all: true
    filter: "(?i)å°|tw|taiwan"
  - name: æ—¥æœ¬
    type: select
    include-all: true
    filter: "(?i)æ—¥|jp|japan"
  - name: ç¾å›½
    type: select
    include-all: true
    filter: "(?i)ç¾|us|unitedstates|united states"
  - name: ç‹®åŸ
    type: select
    include-all: true
    filter: "(?i)(æ–°|sg|singapore)"
  - name: å…¶å®ƒåœ°åŒº
    type: select
    include-all: true
    filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates)).*"
  - name: å…¨éƒ¨èŠ‚ç‚¹
    type: select
    include-all: true
  - name: è‡ªåŠ¨é€‰æ‹©
    type: url-test
    include-all: true
    tolerance: 10

# è§„åˆ™ç­–ç•¥
rules:
  # åŸŸåè§„åˆ™
  - RULE-SET,Local_ip,å›½å†…ç›´è¿,no-resolve
  - RULE-SET,OpenAI,OpenAI
  - RULE-SET,YouTube,è°·æ­ŒæœåŠ¡
  - RULE-SET,Google,è°·æ­ŒæœåŠ¡
  - RULE-SET,GitHub,å¾®è½¯æœåŠ¡
  - RULE-SET,OneDrive,å¾®è½¯æœåŠ¡
  - RULE-SET,Microsoft,å¾®è½¯æœåŠ¡
  - RULE-SET,Epic,æ¸¸æˆå¹³å°
  - RULE-SET,Steam,æ¸¸æˆå¹³å°
  - RULE-SET,Telegram,ç”µæŠ¥ä¿¡æ¯
  - RULE-SET,PayPal,ç¤¾äº¤å¹³å°
  - RULE-SET,Spotify,ç¤¾äº¤å¹³å°
  - RULE-SET,Twitter,ç¤¾äº¤å¹³å° 
  - RULE-SET,Instagram,ç¤¾äº¤å¹³å°
  - RULE-SET,Facebook,ç¤¾äº¤å¹³å°
  - RULE-SET,TikTok,æµ·å¤–åª’ä½“
  - RULE-SET,Disney,æµ·å¤–åª’ä½“
  - RULE-SET,Netflix,æµ·å¤–åª’ä½“
  - RULE-SET,Apple,è‹¹æœæœåŠ¡
  - RULE-SET,Bilibili,å›½å†…ç›´è¿
  - RULE-SET,China,å›½å†…ç›´è¿
  - RULE-SET,GlobalGFW,æµ·å¤–åŠ é€Ÿ
  # ipcidr
  - RULE-SET,Google_ip,è°·æ­ŒæœåŠ¡
  - RULE-SET,Telegram_ip,ç”µæŠ¥ä¿¡æ¯
  - RULE-SET,Twitter_ip,ç¤¾äº¤å¹³å°
  - RULE-SET,Facebook_ip,ç¤¾äº¤å¹³å°
  - RULE-SET,Netflix_ip,æµ·å¤–åª’ä½“
  - RULE-SET,China_ip,å›½å†…ç›´è¿
  - MATCH,å…œåº•è§„åˆ™

######### è§„åˆ™é”šç‚¹ #######
rule-anchor:
  # ipcidr è§„åˆ™ç›¸å…³
  ipcidr: &ipcidr {type: http, interval: 43200, behavior: ipcidr, format: mrs}
  # domain è§„åˆ™ç›¸å…³
  domain: &domain {type: http, interval: 43200, behavior: domain, format: mrs}

# è§„åˆ™é›†è®¢é˜…
rule-providers:
  # ChatGPT
  OpenAI: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/Openai.mrs}
  # è°·æ­Œ
  YouTube: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/YouTube.mrs}
  Google: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/Google.mrs}
  # å¾®è½¯
  GitHub: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/GitHub.mrs}
  OneDrive: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/OneDrive.mrs}
  Microsoft: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/Microsoft.mrs}
  # æ¸¸æˆ
  Epic: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/Epic.mrs}
  Steam: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/Steam.mrs}
  # ç¤¾äº¤
  Telegram: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/telegram.mrs}
  Facebook: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/Facebook.mrs}
  Instagram: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/Instagram.mrs}
  PayPal: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/PayPal.mrs}
  Twitter: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/Twitter.mrs}
  Spotify: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/Spotify.mrs}
  # å½±è§†
  Netflix: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/Netflix.mrs}
  Disney: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/Disney.mrs}
  TikTok: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/tiktok.mrs}
  # æµ·å¤–
  GlobalGFW: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/Global.mrs}
  # è‹¹æœ
  Apple: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/Apple.mrs}
  # å›½å†…
  Bilibili: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/Bilibili.mrs}
  China: {<<: *domain, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geosite/China.mrs}
  # ipcidr
  Google_ip: {<<: *ipcidr, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geoip/Google.mrs}
  Twitter_ip: {<<: *ipcidr, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geoip/Twitter.mrs}
  Netflix_ip: {<<: *ipcidr, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geoip/Netflix.mrs}
  Telegram_ip: {<<: *ipcidr, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geoip/telegram.mrs}
  Facebook_ip: {<<: *ipcidr, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geoip/Facebook.mrs}
  China_ip: {<<: *ipcidr, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geoip/China.mrs}
  Local_ip: {<<: *ipcidr, url: https://github.com/Abcd789JK/Tools/raw/main/Ruleset/mihomo/geoip/Local.mrs}
